import{p as e,a as b,x as E,t as U,z as A,D as L,L as _}from"./chunk-PVWAREVJ-gVtuFcjs.js";import{u as F}from"./AuthContext-D4lhteYI.js";import{F as w,d as B,e as I,g as R,h as D}from"./index-D2MXpevW.js";import{A as T,b as J,a as k}from"./api-8LSux9jW.js";function M({id:o,title:a,children:l,confirmText:g="Confirm",confirmVariant:n="success",onConfirm:d}){return e.jsx("div",{className:"modal fade",id:o,tabIndex:"-1","aria-labelledby":o+"Label","aria-hidden":"true",children:e.jsx("div",{className:"modal-dialog modal-dialog-centered",children:e.jsxs("div",{className:"modal-content border-0 bg-dark-subtle rounded-4 p-4 pb-3",children:[e.jsxs("div",{className:"modal-header border-0 bg-transparent pt-0",children:[e.jsx("h5",{className:"modal-title fs-4",id:o+"Label",children:a}),e.jsx("button",{type:"button",className:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})]}),e.jsx("div",{className:"modal-body bg-secondary-subtle rounded-4 p-4 mb-2",children:l}),e.jsxs("div",{className:"modal-footer border-0 bg-transparent p-0",children:[e.jsx("button",{type:"button",className:"btn btn-secondary me-2","data-bs-dismiss":"modal",children:"Cancel"}),e.jsx("button",{type:"button",className:`btn btn-${n} m-0`,onClick:d,"data-bs-dismiss":"modal",children:g})]})]})})})}function z({user:o,onUpdate:a}){const[l,g]=b.useState(!1),[n,d]=b.useState(!1),[v,m]=b.useState(null),[x,u]=b.useState(null),[p,f]=b.useState(null),j=b.useRef(null),C=i=>{const r=i.target.files[0];if(!r)return;if(!["image/png","image/jpeg","image/jpg","image/gif","image/webp"].includes(r.type)){m("Please select a valid image file (PNG, JPG, GIF, or WebP)");return}if(r.size>5*1024*1024){m("File size must be less than 5MB");return}const N=new FileReader;N.onloadend=()=>u(N.result),N.readAsDataURL(r),P(r)},P=async i=>{g(!0),m(null);const r=new FormData;r.append("file",i);try{const N=(await J(`/upload/profile-picture/${o.id}`,r)).user;localStorage.setItem("user",JSON.stringify(N)),a&&a(N),u(null)}catch(y){m(y.message||"Failed to upload image"),u(null)}finally{g(!1)}},S=async()=>{d(!0),m(null);try{const i=await k(`/upload/profile-picture/${o.id}`,{method:"DELETE"}),r=await i.json();if(!i.ok)throw new Error(r.error||"Delete failed");const y=r.user;localStorage.setItem("user",JSON.stringify(y)),a&&a(y)}catch(i){m(i.message||"Failed to delete image")}finally{d(!1)}},t=()=>j.current?.click(),h=()=>t(),s=x||(o?.profile_picture?`${T}${o.profile_picture}`:null),c=!!(o?.profile_picture||x);return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"d-flex flex-column align-items-center gap-3",children:[e.jsxs("div",{className:"position-relative rounded-circle overflow-hidden border",style:{width:200,height:200},children:[e.jsx("img",{src:s||"https://placehold.co/200?text=No+Photo",alt:"User profile",className:"w-100 h-100",style:{opacity:l||n?.5:1,transition:"opacity 0.2s ease"}}),(l||n)&&e.jsx("div",{className:"position-absolute top-50 start-50 translate-middle",children:e.jsx(w,{icon:B,spin:!0,className:"fs-1 text-primary"})}),e.jsx("input",{ref:j,type:"file",accept:"image/png,image/jpeg,image/jpg,image/gif,image/webp",onChange:C,className:"d-none"}),e.jsxs("div",{className:"position-absolute bottom-0 start-0 w-100 d-flex justify-content-center align-items-center gap-3 bg-dark bg-opacity-75 py-1",children:[e.jsx("button",{type:"button",className:"bg-transparent border-0 p-0 text-white",title:c?"Change photo":"Add photo","data-bs-toggle":"modal","data-bs-target":"#profilePictureActionModal",onClick:()=>f("upload"),disabled:l||n,children:e.jsx(w,{icon:c?I:R})}),c&&e.jsx("button",{type:"button",className:"bg-transparent border-0 p-0 text-danger",title:"Delete photo","data-bs-toggle":"modal","data-bs-target":"#profilePictureActionModal",onClick:()=>f("delete"),disabled:l||n,children:e.jsx(w,{icon:D})})]})]}),v&&e.jsx("div",{className:"alert alert-danger mb-0 w-100 text-center",children:v})]}),e.jsx(M,{id:"profilePictureActionModal",title:p==="delete"?"Delete Profile Picture":"Upload Profile Picture",confirmText:p==="delete"?"Delete":"Confirm",confirmVariant:p==="delete"?"danger":"success",onConfirm:p==="delete"?S:h,children:p==="delete"?e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"fs-5 mb-1",children:"Are you sure you want to delete your profile picture?"}),e.jsx("p",{className:"mb-0",children:"This action cannot be undone. You can upload a new one later."})]}):e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"fs-5 mb-1",children:"Please select an image that meets the following requirements:"}),e.jsxs("ul",{className:"mb-0",children:[e.jsx("li",{children:"Formats: PNG, JPG, JPEG, GIF, WebP"}),e.jsx("li",{children:"Maximum size: 5MB"}),e.jsx("li",{children:"Square / centered images look best"})]})]})})]})}function $({itemId:o,itemType:a,onRemove:l}){const[g,n]=b.useState(!1),{user:d,login:v}=F(),m=async x=>{if(x.preventDefault(),x.stopPropagation(),!!d){n(!0);try{const u=a==="course"?`/users/${d.id}/favourite-courses/${o}`:`/users/${d.id}/saved-blogs/${o}`,p=await k(u,{method:"DELETE"});if(!p.ok)throw new Error("Failed to remove item");const f=await p.json(),j=localStorage.getItem("token");j&&(localStorage.setItem("user",JSON.stringify(f)),v(j,f)),l&&l(o)}catch(u){console.error("Error removing item:",u)}finally{n(!1)}}};return e.jsx("button",{className:"btn btn-sm btn-danger position-absolute bottom-0 start-0 m-2 z-3 border-0",onClick:m,disabled:g,title:"Remove from list",style:{opacity:g?.6:1,transition:"all 0.2s ease",borderRadius:"12px"},children:e.jsx(w,{icon:D})})}async function G(){const o=JSON.parse(localStorage.getItem("user")||"{}");if(!o.id)return{ownedCourses:[],favouriteCourses:[],savedBlogs:[]};try{const a=await k(`/users/${o.id}?expand=true`);if(!a.ok)throw new Error("Failed to fetch user data");const l=await a.json();return{ownedCourses:l.owned_courses||[],favouriteCourses:l.favourite_courses||[],savedBlogs:l.saved_blogs||[]}}catch(a){return console.error("Error fetching user data:",a),{ownedCourses:[],favouriteCourses:[],savedBlogs:[]}}}G.hydrate=!0;const Y=E(function(){const{user:a,logout:l,login:g}=F(),n=U(),{ownedCourses:d,favouriteCourses:v,savedBlogs:m}=A(),x=L(),[u,p]=b.useState(v),[f,j]=b.useState(m),C=()=>{l(),n("/")},P=t=>{const h=localStorage.getItem("token");h&&g(h,t),x.revalidate()},S=[{id:"collapseOne",title:"Owned Courses",badgeColor:"success",count:d.length,items:d.map(t=>({id:t.id,title:t.name,description:t.description,linkPath:`/courses/${t.topic}/${t.id}`,imgUrl:t.image_url||"https://placehold.co/175",imgAlt:t.image_alt||t.name,tags:t.tags||[],removable:!1,type:"course"}))},{id:"collapseTwo",title:"Favourited Courses",badgeColor:"primary",count:u.length,items:u.map(t=>({id:t.id,title:t.name,description:t.description,linkPath:`/courses/${t.topic}/${t.id}`,imgUrl:t.image_url||"https://placehold.co/175",imgAlt:t.image_alt||t.name,tags:t.tags||[],removable:!0,type:"course"}))},{id:"collapseThree",title:"Saved Blogs",badgeColor:"warning",count:f.length,items:f.map(t=>({id:t.id,title:t.title,description:t.description,linkPath:`/blog/${t.id}`,imgUrl:t.image_url||"https://placehold.co/400x300",imgAlt:t.image_alt||t.title,tags:t.tags||[],removable:!0,type:"blog"}))}];return e.jsxs("div",{className:"container page-transition",children:[e.jsx("style",{children:`
        .accordion-item:last-child .accordion-button.collapsed {
          border-radius: 0 0 1.5rem 1.5rem !important;
        }
        .accordion-item:last-child:has(.accordion-collapse.show) {
          border-radius: 0 !important;
        }
        .accordion-item:last-child .accordion-body {
          border-radius: 0 0 1.5rem 1.5rem;
        }
      `}),e.jsx("div",{className:"row justify-content-center",children:e.jsxs("div",{className:"col-12 col-lg-8",children:[e.jsxs("div",{className:"d-flex bg-dark-subtle p-4 rounded-4 mt-4 mb-5 shadow position-relative",children:[e.jsx("button",{className:"btn btn-secondary position-absolute top-0 end-0 m-3",onClick:C,children:"Logout"}),e.jsxs("div",{className:"row g-4 justify-content-center justify-content-md-start w-100",children:[e.jsx("div",{className:"col-12 col-md-auto d-flex justify-content-center",children:e.jsx(z,{user:a,onUpdate:P})}),e.jsx("div",{className:"col-12 col-md",children:e.jsxs("div",{className:"d-flex flex-column justify-content-center align-items-center align-items-md-start h-100",children:[e.jsx("h2",{className:"text-capitalize",children:a?.username||"User Name"}),e.jsx("h4",{children:a?.email||"email@address.com"}),e.jsx("p",{className:"text-secondary fs-5 m-0",children:a?.created_at?`Joined on ${new Date(a.created_at).toLocaleDateString()}`:"Joined on 10/12/2024"})]})})]})]}),e.jsx("div",{className:"accordion rounded-4 shadow",id:"accordionExample",children:S.map((t,h)=>e.jsxs("div",{className:`accordion-item bg-dark-subtle border-0 ${h===0?"rounded-top-4":h===2?"rounded-bottom-4":""}`,children:[e.jsx("h2",{className:"accordion-header",children:e.jsxs("button",{className:`accordion-button bg-dark-subtle fs-4 collapsed border-0 ${h===0?"rounded-top-4":""}`,type:"button","data-bs-toggle":"collapse","data-bs-target":`#${t.id}`,"aria-expanded":h===0?"true":"false","aria-controls":t.id,children:[e.jsx("span",{className:`badge text-bg-${t.badgeColor} me-3`,children:t.count}),t.title]})}),e.jsx("div",{id:t.id,className:"accordion-collapse collapse","data-bs-parent":"#accordionExample",children:e.jsx("div",{className:"accordion-body p-4",children:t.items.length===0?e.jsx("div",{className:"text-center py-5",children:e.jsxs("p",{className:"text-muted fs-5",children:["No ",t.title.toLowerCase()," yet"]})}):e.jsx("div",{className:"row row-cols-1 g-3",children:t.items.map(s=>e.jsx("div",{className:"col",children:e.jsxs("div",{className:"position-relative",children:[e.jsx(_,{className:"card border-0 bg-secondary-subtle text-decoration-none rounded-4 shadow",to:s.linkPath,children:e.jsxs("div",{className:"row g-0",children:[e.jsx("div",{className:"col-auto",children:e.jsx("img",{src:s.imgUrl,className:"img-fluid rounded-start-4",style:{width:"175px",height:"175px",objectFit:"cover"},alt:s.imgAlt})}),e.jsx("div",{className:"col",children:e.jsxs("div",{className:"card-body h-100 align-content-center py-3 d-flex flex-column justify-content-between",children:[e.jsx("h5",{className:"card-title",children:s.title}),e.jsx("p",{className:"card-text m-0",children:s.description}),s.tags&&s.tags.length>0&&e.jsx("div",{className:"d-flex gap-1 mt-2",children:s.tags.map((c,i)=>e.jsx("span",{className:"badge text-capitalize",style:{backgroundColor:c.color},children:c.label},`${s.title}-${c.label}-${i}`))})]})})]})}),s.removable&&s.type==="course"&&e.jsx($,{itemId:s.id,itemType:"course",onRemove:c=>p(i=>i.filter(r=>r.id!==c))}),s.removable&&s.type==="blog"&&e.jsx($,{itemId:s.id,itemType:"blog",onRemove:c=>j(i=>i.filter(r=>r.id!==c))})]})},s.id))})})})]},t.id))})]})})]})});export{G as clientLoader,Y as default};
